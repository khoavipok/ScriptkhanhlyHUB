
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local UILibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/khoavipok/Khanhlymenu/refs/heads/main/Menu%20simple"))()
local Window = UILibrary:CreateWindow("üîπkhanhly Praniumüîπ", UDim2.new(0, 250, 0, 380))
local Info = Window:CreateLabel("Selected: None")
local StateLabel = Window:CreateLabel("State: Idle")
local SelectedPlayer = nil
local TpLoop = false
local SavedPosition = nil
local AutoSafe = false
local LowHPThreshold = 0.3
local HighHPThreshold = 0.7
local FallYThreshold = -487.1
local AbsoluteFailSafeY = -1000
local StarPoints = 5
local StarRadius = 10
local StarSpeed = 40
local PlayerList = Instance.new("ScrollingFrame", Window:GetContainer())
PlayerList.Size = UDim2.new(1, -10, 0, 150)
PlayerList.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
PlayerList.BackgroundTransparency = 0.2
PlayerList.ScrollBarThickness = 5
local ListLayout = Instance.new("UIListLayout", PlayerList)
local PlayerButtons = {}
local HighlightFolder = Instance.new("Folder", game.CoreGui)
HighlightFolder.Name = "TP_Highlights"
local CurrentHighlight = nil
local CycleCamera = false
local LastSwitch = tick()
local CurrentMode = "LookAt"
Window:CreateToggle("Cycle Camera", function(state)
    CycleCamera = state
    LastSwitch = tick()
    CurrentMode = "LookAt"
end)
local function applyHighlight(plr)
    if CurrentHighlight then
        CurrentHighlight:Destroy()
        CurrentHighlight = nil
    end
    if plr and plr.Character then
        local highlight = Instance.new("Highlight")
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.OutlineColor = Color3.fromRGB(255, 50, 50)
        highlight.FillTransparency = 0.5
        highlight.Adornee = plr.Character
        highlight.Parent = HighlightFolder
        CurrentHighlight = highlight
    end
end
local function selectPlayer(plr)
    SelectedPlayer = plr
    Info.Text = "Selected: " .. (plr and plr.Name or "None")
    applyHighlight(plr)
end
local function addPlayer(plr)
    if plr == LocalPlayer or PlayerButtons[plr] then return end
    local Btn = Instance.new("TextButton")
    Btn.Size = UDim2.new(1, -5, 0, 25)
    Btn.Text = plr.Name
    Btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    Btn.TextColor3 = Color3.new(1, 1, 1)
    Btn.Parent = PlayerList
    Btn.MouseButton1Click:Connect(function()
        selectPlayer(plr)
    end)
    PlayerButtons[plr] = Btn
end
local function removePlayer(plr)
    if PlayerButtons[plr] then
        PlayerButtons[plr]:Destroy()
        PlayerButtons[plr] = nil
        if SelectedPlayer == plr then
            SelectedPlayer = nil
            Info.Text = "Selected: None"
            if CurrentHighlight then
                CurrentHighlight:Destroy()
                CurrentHighlight = nil
            end
        end
    end
end
local function refreshPlayers()
    for _, btn in pairs(PlayerButtons) do btn:Destroy() end
    PlayerButtons = {}
    for _, plr in pairs(Players:GetPlayers()) do addPlayer(plr) end
end
refreshPlayers()
Players.PlayerAdded:Connect(addPlayer)
Players.PlayerRemoving:Connect(removePlayer)
Window:CreateButton("Reset Player List", refreshPlayers)
Window:CreateToggle("TP Star Orbit", function(state)
    TpLoop = state
    AutoSafe = false
    if state then
        local myChar = LocalPlayer.Character
        if myChar and myChar:FindFirstChild("HumanoidRootPart") then
            SavedPosition = myChar.HumanoidRootPart.CFrame
        end
        Camera.CameraType = Enum.CameraType.Scriptable
    else
        Camera.CameraSubject = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") or LocalPlayer
        Camera.CameraType = Enum.CameraType.Custom
        if SavedPosition and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            pcall(function() LocalPlayer.Character:PivotTo(SavedPosition) end)
        end
    end
end)
Window:CreateButton("TP Now", function()
    if SelectedPlayer and SelectedPlayer.Character then
        local targetRoot = SelectedPlayer.Character:FindFirstChild("HumanoidRootPart")
        if targetRoot and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character:PivotTo(targetRoot.CFrame)
        end
    end
end)
local function getStarPoint(t, targetPos)
    local step = (math.floor(t * StarSpeed) % StarPoints) * 2 % StarPoints
    local pointAngle = step * (2 * math.pi / StarPoints)
    local x = math.cos(pointAngle) * StarRadius
    local z = math.sin(pointAngle) * StarRadius
    return targetPos + Vector3.new(x, 0, z)
end
RunService.RenderStepped:Connect(function()
    if not LocalPlayer.Character then return end
    local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    local myRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    local targetRoot = SelectedPlayer and SelectedPlayer.Character and SelectedPlayer.Character:FindFirstChild("HumanoidRootPart")
    if TpLoop then
        StateLabel.Text = "State: Orbiting (Star)"
    elseif AutoSafe then
        StateLabel.Text = "State: Safe"
    else
        StateLabel.Text = "State: Idle"
    end
    if humanoid then
        local hpPercent = humanoid.Health / humanoid.MaxHealth
        if TpLoop and hpPercent < LowHPThreshold then
            if SavedPosition and myRoot then
                pcall(function() LocalPlayer.Character:PivotTo(SavedPosition) end)
            end
            TpLoop = false
            AutoSafe = true
            Camera.CameraType = Enum.CameraType.Custom
            return
        end
        if AutoSafe and hpPercent > HighHPThreshold and SelectedPlayer then
            TpLoop = true
            AutoSafe = false
            if myRoot then SavedPosition = myRoot.CFrame end
        end
    end
    if myRoot and SavedPosition then
        if TpLoop and (myRoot.Position.Y <= FallYThreshold or myRoot.Position.Y <= AbsoluteFailSafeY) then
            pcall(function() LocalPlayer.Character:PivotTo(SavedPosition) end)
            TpLoop = false
            AutoSafe = true
            Camera.CameraType = Enum.CameraType.Custom
            return
        end
    end
    if TpLoop and targetRoot and myRoot then
        local t = tick()
        local newPos = getStarPoint(t, targetRoot.Position)
        myRoot.CFrame = CFrame.new(newPos, targetRoot.Position)
    end
    if CycleCamera and targetRoot then
        if tick() - LastSwitch >= 3 then
            LastSwitch = tick()
            if CurrentMode == "LookAt" then
                CurrentMode = "Spectate"
            else
                CurrentMode = "LookAt"
            end
        end

        if CurrentMode == "LookAt" then
            local camPos = Camera.CFrame.Position
            Camera.CFrame = CFrame.lookAt(camPos, targetRoot.Position)
        elseif CurrentMode == "Spectate" then
            local backOffset = targetRoot.CFrame.LookVector * -10
            local camPos = targetRoot.Position + Vector3.new(0, 5, 0) + backOffset
            Camera.CFrame = CFrame.lookAt(camPos, targetRoot.Position)
        end
    end
end)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TOOL_NAME = "Death Counter"
local function showLoadingScreen(seconds)
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "DeathCounterLoading"
	screenGui.ResetOnSpawn = false
	screenGui.IgnoreGuiInset = true
	screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 0.3
	label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	label.TextColor3 = Color3.fromRGB(255, 255, 255)
	label.TextStrokeTransparency = 0
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.Text = "üîç checking player... (" .. seconds .. "s)"
	label.Parent = screenGui
	for i = seconds - 1, 0, -1 do
		task.wait(1)
		label.Text = "üîç checking player... (" .. i .. "s)"
	end
	screenGui:Destroy()
end
local function showESP(player, text, color)
	local char = player.Character
	if not char then return end
	local head = char:FindFirstChild("Head")
	if not head then return end
	if head:FindFirstChild("DeathESP") then
		head.DeathESP:Destroy()
	end
	local billboard = Instance.new("BillboardGui")
	billboard.Name = "DeathESP"
	billboard.Adornee = head
	billboard.Size = UDim2.new(0, 200, 0, 50)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.AlwaysOnTop = tri·ªáu 
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = text
	label.TextColor3 = color
	label.TextStrokeTransparency = 0
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.Parent = billboard

	billboard.Parent = head

	task.delay(10, function()
		if billboard and billboard.Parent then
			billboard:Destroy()
		end
	end)
end
local function trackPlayer(player)
	task.spawn(function()
		local lastState = nil
		while player.Parent do
			local hasTool = false
			local backpack = player:FindFirstChild("Backpack")
			local character = player.Character
			if backpack and backpack:FindFirstChild(TOOL_NAME) then
				hasTool = true
			elseif character and character:FindFirstChild(TOOL_NAME) then
				hasTool = true
			end

			if hasTool ~= lastState then
				lastState = hasTool
				if hasTool then
					showESP(player, "üü¢ CH∆ØA B·∫¨T / not turned on DEATH COUNTER", Color3.fromRGB(0, 255, 0))
				else
					showESP(player, "üî¥ turned on / ƒë√£ b·∫≠t DEATH COUNTER", Color3.fromRGB(255, 0, 0))
				end
			end

			task.wait(1.5)
		end
	end)
end
task.spawn(function()
	showLoadingScreen(10) 
end)
task.wait(5) 
for _, plr in pairs(Players:GetPlayers()) do
	if plr ~= LocalPlayer then
		trackPlayer(plr)
	end
end
Players.PlayerAdded:Connect(function(plr)
	if plr ~= LocalPlayer then
		trackPlayer(plr)
	end
end)
-- ‚ö° Auto Fix Lag Hardcore (No Toggle, Player gi·ªØ nguy√™n)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Lighting = game:GetService("Lighting")

-- üîπ Chuy·ªÉn Part/MeshPart th√†nh block x√°m
local function toBlock(obj)
    if obj:IsA("MeshPart") or obj:IsA("Part") then
        obj.Material = Enum.Material.SmoothPlastic
        obj.CastShadow = false
        obj.Color = Color3.fromRGB(60, 60, 60)
        obj.Transparency = 0
        if obj:IsA("MeshPart") then
            obj.TextureID = "" -- xo√° texture
        end
    end
end

-- üîπ Xo√° hi·ªáu ·ª©ng n·∫∑ng
local function removeEffects(obj)
    if obj:IsA("ParticleEmitter") or obj:IsA("Trail") 
    or obj:IsA("Smoke") or obj:IsA("Fire") 
    or obj:IsA("Sparkles") or obj:IsA("Beam") then
        pcall(function() obj:Destroy() end)
    end

    if obj:IsA("Decal") or obj:IsA("SurfaceAppearance") then
        pcall(function() obj:Destroy() end)
    end
end

-- üîπ √Åp d·ª•ng fix lag
local function optimize(v)
    if not v:IsDescendantOf(LocalPlayer.Character) then
        toBlock(v)
        removeEffects(v)
    end
end

-- Qu√©t to√†n map ban ƒë·∫ßu
for _, v in pairs(workspace:GetDescendants()) do
    optimize(v)
end

-- V·ªõi object spawn sau
workspace.DescendantAdded:Connect(optimize)

-- üîπ Xo√° Skybox c≈©
for _, v in ipairs(Lighting:GetChildren()) do
    if v:IsA("Sky") then v:Destroy() end
end

-- üîπ T·∫°o Sky x√°m tr·∫Øng
local sky = Instance.new("Sky")
local blank = "rbxassetid://5102043934" -- texture tr·∫Øng
sky.SkyboxBk, sky.SkyboxDn, sky.SkyboxFt = blank, blank, blank
sky.SkyboxLf, sky.SkyboxRt, sky.SkyboxUp = blank, blank, blank
sky.Parent = Lighting

-- üîπ Gi·∫£m hi·ªáu ·ª©ng √°nh s√°ng
settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
Lighting.GlobalShadows = false
Lighting.FogEnd = 9999
Lighting.Brightness = 1
Lighting.OutdoorAmbient = Color3.new(1, 1, 1)

print("‚úÖ Auto Fix Lag Hardcore: Map block x√°m, hi·ªáu ·ª©ng xo√° s·∫°ch, Sky x√°m tr·∫Øng, Player gi·ªØ nguy√™n.")
