--// Rayfield UI Loader
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "üé£ Fishing Khanhly",
   LoadingTitle = "üåäKhanhlyHubüåä",
   LoadingSubtitle = "by Khanhly",
   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "KhanhlyHub"
   },
   Discord = {
      Enabled = false,
   },
   KeySystem = false,
})

local DiscordTab = Window:CreateTab("Discord Link", nil) -- Title, Image
    local MainSection = DiscordTab:CreateSection("Discord Link plss copy thank!")

local Button = DiscordTab:CreateButton({
    Name = "Copy Discord Link",
    Callback = function()
        local link = "https://discord.gg/raAPZrETkZ"

        if setclipboard then
            setclipboard(link)
            
            -- Hi·ªÉn th·ªã th√¥ng b√°o
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "‚úÖ Copy th√†nh c√¥ng!",
                Text = "ƒê√£ copy link Discord v√†o clipboard.",
                Duration = 5
            })
        else
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "‚ö† Kh√¥ng th·ªÉ copy",
                Text = "M√¥i tr∆∞·ªùng kh√¥ng h·ªó tr·ª£ setclipboard.",
                Duration = 5
            })
        end
    end,
})

local MainTab = Window:CreateTab("farmüêü", nil) -- Title, Image
    local MainSection = MainTab:CreateSection("autoClick")

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local Net = RS.Packages._Index["sleitnick_net@0.2.0"].net

-- Remotes
local equipTool     = Net:FindFirstChild("RE/EquipToolFromHotbar")
local chargeRod     = Net:FindFirstChild("RF/ChargeFishingRod")
local startMinigame = Net:FindFirstChild("RF/RequestFishingMinigameStarted")
local finishFishing = Net:FindFirstChild("RE/FishingCompleted")

local player = Players.LocalPlayer
local autoFishing = false -- c·ªù b·∫≠t/t·∫Øt

-- √âp c·∫ßm c·∫ßn
local function forceEquipRod()
    pcall(function()
        equipTool:FireServer(1) -- √©p slot 1 (c·∫ßn c√¢u)
    end)
end

-- Toggle trong Rayfield UI
local Toggle = MainTab:CreateToggle({
   Name = "Auto sentence fish",
   CurrentValue = false,
   Flag = "AutoFishingToggle",
   Callback = function(Value)
      autoFishing = Value
   end,
})

-- Loop auto fishing
task.spawn(function()
    while true do
        task.wait(0.1)
        if autoFishing then
            -- 0. C·∫ßm c·∫ßn
            forceEquipRod()
            task.wait(1)

            -- 1. Charge Rod
            local chargeValue = tick() * 1000
            pcall(function() chargeRod:InvokeServer(chargeValue) end)
            task.wait(1)

            -- 2. N√©m phao
            local args = {
                [1] = math.random(-2, 2),
                [2] = math.random()
            }
            pcall(function() startMinigame:InvokeServer(unpack(args)) end)

            -- 3. Skip minigame
            task.wait(2.9)
            pcall(function() finishFishing:FireServer() end)

            -- 4. Ch·ªù 1.2s r·ªìi l·∫∑p v√≤ng m·ªõi
            task.wait(0.1)
        end
    end
end)

local MainSection = MainTab:CreateSection("farm+Event")


-- Farm To·∫° ƒê·ªô (C·∫•p b·∫≠c 2)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- To·∫° ƒë·ªô + g√≥c xoay b·∫°n mu·ªën farm
local FARM_POS = Vector3.new(1003.1, 2.5, 5085.3) -- ch·ªânh theo to·∫° ƒë·ªô b·∫°n mu·ªën
local FARM_YAW = 140.6 -- g√≥c quay (theo ƒë·ªô, v√≠ d·ª•: ƒê√¥ng = 90, T√¢y = -90)

local farming = false
local hrp

-- C·∫≠p nh·∫≠t HRP khi respawn
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

hrp = getHRP()
player.CharacterAdded:Connect(function(char)
    hrp = char:WaitForChild("HumanoidRootPart")
end)

-- Platform d∆∞·ªõi ch√¢n
local function createPlatform()
    local p = workspace:FindFirstChild("FarmPlatform")
    if not p then
        p = Instance.new("Part")
        p.Name = "FarmPlatform"
        p.Size = Vector3.new(20, 1, 20)
        p.Anchored = true
        p.CanCollide = true
        p.Parent = workspace
    end
    p.Position = FARM_POS - Vector3.new(0, 3, 0)
end

-- TP li√™n t·ª•c (t·ªça ƒë·ªô + xoay)
RunService.Heartbeat:Connect(function()
    if farming and hrp then
        -- N·∫øu c√≥ Event (c·∫•p b·∫≠c 1) th√¨ b·ªè qua farm t·ªça ƒë·ªô
        if workspace:FindFirstChild("Shark Hunt") 
        or workspace:FindFirstChild("Megalodon Hunt")
        or workspace:FindFirstChild("Ghost Shark Hunt") then
            return
        end

        createPlatform()
        hrp.CFrame = CFrame.new(FARM_POS) * CFrame.Angles(0, math.rad(FARM_YAW), 0)
    end
end)

-- üî• Toggle Rayfield
local FarmToggle = MainTab:CreateToggle({
   Name = "Tp farm coins",
   CurrentValue = false,
   Flag = "FarmToaDo",
   Callback = function(Value)
       farming = Value
   end,
})

-- Farm To·∫° ƒê·ªô (C·∫•p b·∫≠c 2)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- To·∫° ƒë·ªô + g√≥c xoay b·∫°n mu·ªën farm
local FARM_POS = Vector3.new(3302.0, -1302.3, 1421.0) -- ch·ªânh theo to·∫° ƒë·ªô b·∫°n mu·ªën
local FARM_YAW = 108.0 -- g√≥c quay (theo ƒë·ªô, v√≠ d·ª•: ƒê√¥ng = 90, T√¢y = -90)

local farming = false
local hrp

-- C·∫≠p nh·∫≠t HRP khi respawn
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

hrp = getHRP()
player.CharacterAdded:Connect(function(char)
    hrp = char:WaitForChild("HumanoidRootPart")
end)

-- Platform d∆∞·ªõi ch√¢n
local function createPlatform()
    local p = workspace:FindFirstChild("FarmPlatform")
    if not p then
        p = Instance.new("Part")
        p.Name = "FarmPlatform"
        p.Size = Vector3.new(20, 1, 20)
        p.Anchored = true
        p.CanCollide = true
        p.Parent = workspace
    end
    p.Position = FARM_POS - Vector3.new(0, 3, 0)
end

-- TP li√™n t·ª•c (t·ªça ƒë·ªô + xoay)
RunService.Heartbeat:Connect(function()
    if farming and hrp then
        -- N·∫øu c√≥ Event (c·∫•p b·∫≠c 1) th√¨ b·ªè qua farm t·ªça ƒë·ªô
        if workspace:FindFirstChild("Shark Hunt") 
        or workspace:FindFirstChild("Megalodon Hunt")
        or workspace:FindFirstChild("Ghost Shark Hunt") then
            return
        end

        createPlatform()
        hrp.CFrame = CFrame.new(FARM_POS) * CFrame.Angles(0, math.rad(FARM_YAW), 0)
    end
end)

-- üî• Toggle Rayfield
local FarmToggle = MainTab:CreateToggle({
   Name = "Farm stone Enchant",
   CurrentValue = false,
   Flag = "FarmToaDo",
   Callback = function(Value)
       farming = Value
   end,
})

-- Farm To·∫° ƒê·ªô (C·∫•p b·∫≠c 2)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- To·∫° ƒë·ªô + g√≥c xoay b·∫°n mu·ªën farm
local FARM_POS = Vector3.new(-3706.5, -124.4, -922.4) -- ch·ªânh theo to·∫° ƒë·ªô b·∫°n mu·ªën
local FARM_YAW = -152.3 -- g√≥c quay (theo ƒë·ªô, v√≠ d·ª•: ƒê√¥ng = 90, T√¢y = -90)

local farming = false
local hrp

-- C·∫≠p nh·∫≠t HRP khi respawn
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

hrp = getHRP()
player.CharacterAdded:Connect(function(char)
    hrp = char:WaitForChild("HumanoidRootPart")
end)

-- Platform d∆∞·ªõi ch√¢n
local function createPlatform()
    local p = workspace:FindFirstChild("FarmPlatform")
    if not p then
        p = Instance.new("Part")
        p.Name = "FarmPlatform"
        p.Size = Vector3.new(20, 1, 20)
        p.Anchored = true
        p.CanCollide = true
        p.Parent = workspace
    end
    p.Position = FARM_POS - Vector3.new(0, 3, 0)
end

-- TP li√™n t·ª•c (t·ªça ƒë·ªô + xoay)
RunService.Heartbeat:Connect(function()
    if farming and hrp then
        -- N·∫øu c√≥ Event (c·∫•p b·∫≠c 1) th√¨ b·ªè qua farm t·ªça ƒë·ªô
        if workspace:FindFirstChild("Shark Hunt") 
        or workspace:FindFirstChild("Megalodon Hunt")
        or workspace:FindFirstChild("Ghost Shark Hunt") then
            return
        end

        createPlatform()
        hrp.CFrame = CFrame.new(FARM_POS) * CFrame.Angles(0, math.rad(FARM_YAW), 0)
    end
end)

-- üî• Toggle Rayfield
local FarmToggle = MainTab:CreateToggle({
   Name = "TP Farm (Ghostfinn Rod)",
   CurrentValue = false,
   Flag = "FarmToaDo",
   Callback = function(Value)
       farming = Value
   end,
})


-- üìå D·ªãch v·ª•
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

-- üîç H√†m l·∫•y to·∫° ƒë·ªô Event
local function getEventPosition(eventName)
    local eventFolder = workspace.Props:FindFirstChild(eventName)
    if eventFolder then
        -- N·∫øu c√≥ Part c√πng t√™n b√™n trong th√¨ l·∫•y
        local part = eventFolder:FindFirstChild(eventName)
        if part and part:IsA("BasePart") then
            return part.Position
        end
        -- N·∫øu b·∫£n th√¢n n√≥ l√† Part th√¨ l·∫•y lu√¥n
        if eventFolder:IsA("BasePart") then
            return eventFolder.Position
        end
        -- N·∫øu l√† Model ‚Üí l·∫•y PrimaryPart
        if eventFolder:IsA("Model") and eventFolder.PrimaryPart then
            return eventFolder.PrimaryPart.Position
        end
    end
    return nil
end

-- ‚ö° Tr·∫°ng th√°i Toggle
local sharkFarm = false
local megaFarm = false
local ghostFarm = false

-- üìå V√≤ng l·∫∑p TP li√™n t·ª•c
RunService.Heartbeat:Connect(function()
    if sharkFarm then
        local pos = getEventPosition("Shark Hunt")
        if pos then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 5, 0))
        end
    elseif megaFarm then
        local pos = getEventPosition("Megalodon Hunt")
        if pos then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 5, 0))
        end
    elseif ghostFarm then
        local pos = getEventPosition("Ghost Shark Hunt")
        if pos then
            hrp.CFrame = CFrame.new(pos + Vector3.new(0, 5, 0))
        end
    end
end)

-- üéõÔ∏è Toggle Rayfield
local SharkToggle = MainTab:CreateToggle({
    Name = "Farm Shark Hunt",
    CurrentValue = false,
    Flag = "FarmShark",
    Callback = function(Value)
        sharkFarm = Value
        if Value then
            megaFarm = false
            ghostFarm = false
        end
    end,
})

local MegaToggle = MainTab:CreateToggle({
    Name = "Farm Megalodon Hunt",
    CurrentValue = false,
    Flag = "FarmMegalodon",
    Callback = function(Value)
        megaFarm = Value
        if Value then
            sharkFarm = false
            ghostFarm = false
        end
    end,
})

local GhostToggle = MainTab:CreateToggle({
    Name = "Farm Ghost Shark Hunt",
    CurrentValue = false,
    Flag = "FarmGhost",
    Callback = function(Value)
        ghostFarm = Value
        if Value then
            sharkFarm = false
            megaFarm = false
        end
    end,
})


local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

local net = ReplicatedStorage:WaitForChild("Packages")
    ._Index:WaitForChild("sleitnick_net@0.2.0")
    .net:WaitForChild("RF/SellAllItems")

-- Bi·∫øn tr·∫°ng th√°i
local selling = false

local Toggle = MainTab:CreateToggle({
   Name = "sell fish",
   CurrentValue = false,
   Flag = "AutoSellToggle",
   Callback = function(Value)
       selling = Value  -- c·∫≠p nh·∫≠t tr·∫°ng th√°i
       
       if selling then
           -- T·∫°o m·ªôt coroutine ƒë·ªÉ kh√¥ng block main thread
           coroutine.wrap(function()
               while selling do
                   -- G·ªçi server ƒë·ªÉ sell t·∫•t c·∫£ item
                   net:InvokeServer()
                   wait(1)  -- delay 1 gi√¢y gi·ªØa m·ªói l·∫ßn sell, b·∫°n c√≥ th·ªÉ ch·ªânh
               end
           end)()
       end
   end,
})

local MainSection = MainTab:CreateSection("fake")

-- Script ƒë√£ fix: kh√¥ng load MeshId ngo√†i -> kh√¥ng b·ªã "could not fetch"
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:FindFirstChildOfClass("Humanoid")

-- update character on respawn
local function onCharacterAdded(c)
    char = c
    hrp = char:WaitForChild("HumanoidRootPart")
    humanoid = char:FindFirstChildOfClass("Humanoid")
end
player.CharacterAdded:Connect(onCharacterAdded)

-- state
local animTrack = nil
local floatConn = nil
local blackGui = nil
local halo, innerHalo = nil, nil
local swords = {}
local effectsEnabled = false
local magnetEnabled = false
local magnetAngle = 0

-- flash screen
local function flashScreen()
    if not blackGui then
        blackGui = Instance.new("ScreenGui")
        blackGui.IgnoreGuiInset = true
        blackGui.Parent = player:WaitForChild("PlayerGui")

        local frame = Instance.new("Frame")
        frame.Name = "BlackFrame"
        frame.Size = UDim2.fromScale(1,1)
        frame.BackgroundColor3 = Color3.new(0,0,0)
        frame.BackgroundTransparency = 1
        frame.Parent = blackGui
    end
    local frame = blackGui:FindFirstChild("BlackFrame")
    if frame then
        frame.BackgroundTransparency = 0
        local tween = TweenService:Create(frame, TweenInfo.new(2, Enum.EasingStyle.Sine), {BackgroundTransparency = 1})
        tween:Play()
    end
end

-- create halo: outer cylinder + inner transparent cylinder (r·ªóng)
local function createHalo()
    -- outer
    halo = Instance.new("Part")
    halo.Name = "DarkHalo_Outer"
    halo.Size = Vector3.new(6, 0.3, 6)
    halo.Anchored = true
    halo.CanCollide = false
    halo.Color = Color3.fromRGB(20,20,20)
    halo.Material = Enum.Material.Neon
    halo.CFrame = hrp.CFrame * CFrame.new(0, 4, 0) * CFrame.Angles(math.rad(90),0,0)
    halo.Parent = char

    local meshOuter = Instance.new("SpecialMesh", halo)
    meshOuter.MeshType = Enum.MeshType.Cylinder
    meshOuter.Scale = Vector3.new(1, 0.05, 1)

    -- inner (transparent) to fake hole
    innerHalo = Instance.new("Part")
    innerHalo.Name = "DarkHalo_Inner"
    innerHalo.Size = Vector3.new(4, 0.31, 4)
    innerHalo.Anchored = true
    innerHalo.CanCollide = false
    innerHalo.Transparency = 1
    innerHalo.CFrame = halo.CFrame
    innerHalo.Parent = char

    -- subtle light
    local light = Instance.new("PointLight", halo)
    light.Color = Color3.fromRGB(50,50,50)
    light.Brightness = 2
    light.Range = 12

    -- aura particles
    local aura = Instance.new("ParticleEmitter", halo)
    aura.Texture = "rbxassetid://241594419"
    aura.Rate = 6
    aura.Lifetime = NumberRange.new(1.5, 2.5)
    aura.Size = NumberSequence.new({ NumberSequenceKeypoint.new(0, 3), NumberSequenceKeypoint.new(1, 6) })
    aura.Transparency = NumberSequence.new({ NumberSequenceKeypoint.new(0, 0.5), NumberSequenceKeypoint.new(1, 1) })
    aura.Color = ColorSequence.new(Color3.fromRGB(30,30,30))
    aura.Speed = NumberRange.new(0.5, 1.5)
    aura.SpreadAngle = Vector2.new(360, 360)
    aura.LockedToPart = true
end

local function removeHalo()
    if halo then halo:Destroy(); halo = nil end
    if innerHalo then innerHalo:Destroy(); innerHalo = nil end
end

-- create swords (simple parts, no external meshes)
local function createSwords()
    for i = 1, 4 do
        local sword = Instance.new("Part")
        sword.Name = "DarkSword_"..i
        sword.Size = Vector3.new(0.2, 4, 0.6)
        sword.Anchored = true
        sword.CanCollide = false
        sword.Color = Color3.fromRGB(10,10,10)
        sword.Material = Enum.Material.Metal
        sword.Parent = char

        -- small glow / smoke
        local smoke = Instance.new("ParticleEmitter", sword)
        smoke.Texture = "rbxassetid://258128463"
        smoke.Rate = 8
        smoke.Lifetime = NumberRange.new(0.8, 1.6)
        smoke.Size = NumberSequence.new({ NumberSequenceKeypoint.new(0, 0.4), NumberSequenceKeypoint.new(1, 1.2) })
        smoke.Transparency = NumberSequence.new({ NumberSequenceKeypoint.new(0, 0.6), NumberSequenceKeypoint.new(1, 1) })
        smoke.LockedToPart = true

        table.insert(swords, sword)
    end
end

local function removeSwords()
    for _, s in ipairs(swords) do
        if s and s.Parent then s:Destroy() end
    end
    swords = {}
end

-- floating + sword rotation (relative to hrp)
local function startFloating()
    if floatConn then return end
    local t = 0
    floatConn = RunService.RenderStepped:Connect(function(dt)
        t = t + dt * 2
        -- bob player slightly
        if hrp and hrp.Parent then
            local bob = math.sin(t) * 0.5
            hrp.CFrame = hrp.CFrame + Vector3.new(0, bob * dt, 0)
        end

        -- swords rotate around player
        for i, sword in ipairs(swords) do
            if hrp and sword then
                local ang = t + (math.pi/2) * (i-1)
                local radius = 2
                local pos = hrp.Position + Vector3.new(math.cos(ang)*radius, 1, math.sin(ang)*radius)
                sword.CFrame = CFrame.new(pos, hrp.Position)
            end
        end

        -- keep halo on head (fixed)
        if halo and hrp then
            halo.CFrame = hrp.CFrame * CFrame.new(0, 4, 0) * CFrame.Angles(math.rad(90), 0, 0)
            if innerHalo then innerHalo.CFrame = halo.CFrame end
        end
    end)
end

local function stopFloating()
    if floatConn then floatConn:Disconnect() floatConn = nil end
end

-- magnet vehicles (uses workspace.Vehicles if exists)
local function magnetVehicles()
    local vehiclesParent = workspace:FindFirstChild("Vehicles") or workspace
    local hrpLocal = (player.Character and player.Character:FindFirstChild("HumanoidRootPart")) and player.Character.HumanoidRootPart or hrp
    magnetAngle = magnetAngle + 0.1
    for _, v in pairs(vehiclesParent:GetChildren()) do
        if v:IsA("Model") then
            local part = v.PrimaryPart or v:FindFirstChildWhichIsA("BasePart")
            if part then
                v.PrimaryPart = part
                local offset = Vector3.new(math.cos(magnetAngle), 0, math.sin(magnetAngle)) * 25
                local newPos = hrpLocal.Position + offset + Vector3.new(0, 3, 0)
                -- pcall ƒë·ªÉ tr√°nh crash n·∫øu model locked
                pcall(function() v:SetPrimaryPartCFrame(CFrame.new(newPos)) end)
            end
        end
    end
end

-- heartbeat for magnet
RunService.Heartbeat:Connect(function()
    if magnetEnabled then
        pcall(magnetVehicles)
    end
end)

-- Play animation safely (pcall if missing)
local function playAnim()
    if not humanoid then return end
    local success, anim = pcall(function()
        return ReplicatedStorage.Modules and ReplicatedStorage.Modules.Animations and ReplicatedStorage.Modules.Animations:FindFirstChild("NPC_Leaning")
    end)
    if success and anim and humanoid then
        local ok, track = pcall(function() return humanoid:LoadAnimation(anim) end)
        if ok and track then
            animTrack = track
            animTrack:Play()
            -- when animation ends, we can auto-stop effects if desired:
            animTrack.Stopped:Connect(function()
                -- leave as-is; setAll(false) will handle cleanup when toggle off
            end)
        end
    end
end

local function stopAnim()
    if animTrack then
        pcall(function() animTrack:Stop() end)
        animTrack = nil
    end
end

-- main enable/disable
local function setAll(enable)
    effectsEnabled = enable
    if enable then
        flashScreen()
        createHalo()
        createSwords()
        startFloating()
        playAnim()
        magnetEnabled = true
    else
        flashScreen()
        stopAnim()
        removeHalo()
        removeSwords()
        stopFloating()
        magnetEnabled = false
    end
end

-- UI toggle (assumes MainTab exists)
if MainTab then
    MainTab:CreateToggle({
        Name = "Dark v1",
        CurrentValue = false,
        Flag = "DarkKatanaModeFull",
        Callback = function(Value)
            setAll(Value)
        end,
    })
else
    warn("Kh√¥ng t√¨m th·∫•y MainTab ‚Äî d√πng setAll(true/false) ƒë·ªÉ b·∫≠t/t·∫Øt.")
end


-- ‚ö° Toggle ƒë·ªÉ b·∫≠t/t·∫Øt b·∫£ng tho·∫°i + control
local uiToggle = MainTab:CreateToggle({
   Name = "üìãB·∫£ng UI (Speed + jump)",
   CurrentValue = false,
   Flag = "UIToggle",
   Callback = function(Value)
       if Value then
           -- B·∫≠t: ch·∫°y script t·∫°o b·∫£ng
           loadstring([[
               -- >>> TO√ÄN B·ªò SCRIPT UI C·ª¶A B·∫†N <<<

               local Players = game:GetService("Players")
               local RunService = game:GetService("RunService")
               local player = Players.LocalPlayer

               local char, head, humanoid
               local offset = Vector3.new(0, 1, 0)
               local distance = 5
               local currentPos

               local function setupCharacter()
                   char = player.Character or player.CharacterAdded:Wait()
                   head = char:WaitForChild("Head")
                   humanoid = char:WaitForChild("Humanoid")
                   currentPos = head.Position + head.CFrame.LookVector * distance + offset
               end

               setupCharacter()
               player.CharacterAdded:Connect(function()
                   task.wait(1)
                   setupCharacter()
               end)

               local function createPanel(name, size, posOffset)
                   local panel = Instance.new("Part")
                   panel.Name = name
                   panel.Size = size
                   panel.Anchored = true
                   panel.CanCollide = false
                   panel.Transparency = 1
                   panel.Parent = workspace

                   local surfaceGui = Instance.new("SurfaceGui")
                   surfaceGui.Face = Enum.NormalId.Front
                   surfaceGui.AlwaysOnTop = true
                   surfaceGui.LightInfluence = 0
                   surfaceGui.Parent = panel

                   local background = Instance.new("Frame")
                   background.Size = UDim2.new(1, 0, 1, 0)
                   background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                   background.BackgroundTransparency = 0.4
                   background.BorderSizePixel = 0
                   background.Parent = surfaceGui

                   local corners = {}
                   local function createCorner(parent, posX, posY, anchorX, anchorY, rot)
                       local corner = Instance.new("Frame")
                       corner.Size = UDim2.new(0, 40, 0, 40)
                       corner.Position = UDim2.new(posX, 0, posY, 0)
                       corner.AnchorPoint = Vector2.new(anchorX, anchorY)
                       corner.BackgroundTransparency = 1
                       corner.Parent = parent

                       local lineH = Instance.new("Frame")
                       lineH.Size = UDim2.new(1, 0, 0, 3)
                       lineH.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                       lineH.BorderSizePixel = 0
                       lineH.Parent = corner

                       local lineV = Instance.new("Frame")
                       lineV.Size = UDim2.new(0, 3, 1, 0)
                       lineV.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                       lineV.BorderSizePixel = 0
                       lineV.Parent = corner

                       corner.Rotation = rot
                       table.insert(corners, {lineH, lineV})
                   end

                   createCorner(background, 0, 0, 0, 0, 0)
                   createCorner(background, 1, 0, 1, 0, 90)
                   createCorner(background, 1, 1, 1, 1, 180)
                   createCorner(background, 0, 1, 0, 1, 270)

                   return panel, background, corners
               end

               -- B·∫£ng tho·∫°i
               local dialoguePanel, dialogueBg, dialogueCorners = createPanel("DialoguePanel", Vector3.new(6, 4, 0.2))
               local label = Instance.new("TextLabel")
               label.Size = UDim2.new(1, -20, 1, -20)
               label.Position = UDim2.new(0, 10, 0, 10)
               label.BackgroundTransparency = 1
               label.Text = ""
               label.Font = Enum.Font.SourceSansBold
               label.TextSize = 55
               label.TextColor3 = Color3.fromRGB(255, 255, 255)
               label.TextStrokeTransparency = 0.3
               label.TextWrapped = true
               label.Parent = dialogueBg

               local dialogues = {
                   {text = "Th√¥ng tin : khanhly \\ script tbao", waitTime = 10},
                   {text = "Oh man are you hanging up the game", waitTime = 60},
                   {text = "How is your life?", waitTime = 5},
                   {text = "Are you AFK?", waitTime = 5},
                   {text = "I am playing li√™n qu√¢n now", waitTime = 20},
                   {text = "Bored now have to make scripts for users haizz", waitTime = 5},
                   {text = "you look so handsome", waitTime = 10},
                   {text = "Do you like khanhly script?", waitTime = 10},
                   {text = "do you know Tbao script?", waitTime = 10},
                   {text = "Tbao's script is very gay ü§£", waitTime = 10},
                   {text = "what country are you in?", waitTime = 10},
                   {text = "but i live in vietnamüáªüá≥üòò", waitTime = 5},
                   {text = "I think you really like this game?", waitTime = 10},
                   {text = "If you are free, please support Khanhly's scriptüòò", waitTime = 5},
                   {text = "thank bye", waitTime = 5},
               }

               local typingSpeed = 0.05
               task.spawn(function()
                   while true do
                       for _, dialogue in ipairs(dialogues) do
                           label.Text = ""
                           local fullText = dialogue.text
                           for i = 1, #fullText do
                               label.Text = string.sub(fullText, 1, i)
                               task.wait(typingSpeed)
                           end
                           task.wait(dialogue.waitTime)
                       end
                   end
               end)

               -- B·∫£ng control
               local controlPanel, controlBg, controlCorners = createPanel("ControlPanel", Vector3.new(4, 3, 0.2))

               local speedBtn = Instance.new("TextButton")
               speedBtn.Size = UDim2.new(0.8, 0, 0.4, 0)
               speedBtn.Position = UDim2.new(0.1, 0, 0.1, 0)
               speedBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
               speedBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
               speedBtn.TextScaled = true
               speedBtn.Text = "üöÄ Speed +"
               speedBtn.Parent = controlBg
               speedBtn.MouseButton1Click:Connect(function()
                   if humanoid then humanoid.WalkSpeed = humanoid.WalkSpeed + 10 end
               end)

               local jumpBtn = Instance.new("TextButton")
               jumpBtn.Size = UDim2.new(0.8, 0, 0.4, 0)
               jumpBtn.Position = UDim2.new(0.1, 0, 0.55, 0)
               jumpBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
               jumpBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
               jumpBtn.TextScaled = true
               jumpBtn.Text = "ü¶ò Jump +"
               jumpBtn.Parent = controlBg
               jumpBtn.MouseButton1Click:Connect(function()
                   if humanoid then humanoid.JumpPower = humanoid.JumpPower + 10 end
               end)

               local t = 0
               RunService.RenderStepped:Connect(function(dt)
                   if head and head.Parent then
                       local targetPos1 = head.Position + head.CFrame.LookVector * distance + offset
                       currentPos = currentPos:Lerp(targetPos1, 0.05)
                       dialoguePanel.CFrame = CFrame.new(currentPos, head.Position + Vector3.new(0,1,0))

                       local rightOffset = head.CFrame.RightVector * 6
                       local upDownOffset = Vector3.new(0, -0.5, 0)
                       local targetPos2 = head.Position + rightOffset + Vector3.new(0, 1, 0) + upDownOffset
                       controlPanel.CFrame = CFrame.new(targetPos2, head.Position + Vector3.new(0,1,0))

                       t = t + dt
                       local brightness = 0.5 + math.sin(t * 3) * 0.5
                       local color = Color3.new(brightness, brightness, brightness)

                       label.TextColor3 = color
                       for _, c in ipairs(dialogueCorners) do
                           for _, line in ipairs(c) do line.BackgroundColor3 = color end
                       end
                       for _, c in ipairs(controlCorners) do
                           for _, line in ipairs(c) do line.BackgroundColor3 = color end
                       end
                   end
               end)
           ]])()
       else
           -- T·∫Øt: x√≥a c√°c b·∫£ng n·∫øu t·ªìn t·∫°i
           if workspace:FindFirstChild("DialoguePanel") then workspace.DialoguePanel:Destroy() end
           if workspace:FindFirstChild("ControlPanel") then workspace.ControlPanel:Destroy() end
       end
   end,
})


local SpTab = Window:CreateTab("üõçÔ∏èshop", nil) -- Title, Image
    local MainSection = SpTab:CreateSection("shop rod")
    
    local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- H√†m l·∫•y HRP m·ªõi nh·∫•t sau khi reset
local function getHRP()
    local character = player.Character or player.CharacterAdded:Wait()
    return character:WaitForChild("HumanoidRootPart")
end

-- TP ƒë·∫øn Angler Rod Stand
local Button1 = SpTab:CreateButton({
    Name = "Angler Rod 8M",
    Callback = function()
        local hrp = getHRP()
        local targetPart = workspace["!!! MENU RINGS"]["Angler Rod Stand"].Part
        if hrp and targetPart then
            hrp.CFrame = targetPart.CFrame + Vector3.new(0, 3, 0)
        end
    end,
})

-- TP ƒë·∫øn Ares Rod Stand
local Button2 = SpTab:CreateButton({
    Name = "Ares Rod 3M",
    Callback = function()
        local hrp = getHRP()
        local targetPart = workspace["!!! MENU RINGS"]["Ares Rod Stand"].Part
        if hrp and targetPart then
            hrp.CFrame = targetPart.CFrame + Vector3.new(0, 3, 0)
        end
    end,
})


local Net = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net
local PurchaseRod = Net:FindFirstChild("RF/PurchaseFishingRod")

-- B·∫£ng ID c·ªßa t·ª´ng c·∫ßn
local RodIDs = {
    LuckRod = 79,       -- 350$
    CarbonRod = 76,     -- 900$
    GrassRod = 85,      -- 1.50k$
    DemascusRod = 77,   -- 3k$
    IceRod = 78,        -- 5k$
    LuckyRod = 4,       -- 15k$
    MidnightRod = 80,   -- 50k$
    SteampunkRod = 6,   -- 215k$
    ChromeRod = 7,      -- 437k$
    AstralRod = 5,      -- 1M$
}

-- L∆∞u tr·∫°ng th√°i toggle
local autoBuy = {}

-- H√†m auto mua
local function startAutoBuy(id, key)
    task.spawn(function()
        while autoBuy[key] do
            PurchaseRod:InvokeServer(id)
            task.wait(1) -- tr√°nh spam
        end
    end)
end

-- T·∫°o toggle nhanh
local function createRodToggle(name, key, id)
    SpTab:CreateToggle({
        Name = "Auto Buy " .. name,
        CurrentValue = false,
        Flag = "Toggle_" .. key,
        SectionParent = MainSection,
        Callback = function(val)
            autoBuy[key] = val
            if val then startAutoBuy(id, key) end
        end,
    })
end

-- 10 toggle
createRodToggle("Luck Rod (350$)", "LuckRod", RodIDs.LuckRod)
createRodToggle("Carbon Rod (900$)", "CarbonRod", RodIDs.CarbonRod)
createRodToggle("Grass Rod (1.50k$)", "GrassRod", RodIDs.GrassRod)
createRodToggle("Demascus Rod (3k$)", "DemascusRod", RodIDs.DemascusRod)
createRodToggle("Ice Rod (5k$)", "IceRod", RodIDs.IceRod)
createRodToggle("Lucky Rod (15k$)", "LuckyRod", RodIDs.LuckyRod)
createRodToggle("Midnight Rod (50k$)", "MidnightRod", RodIDs.MidnightRod)
createRodToggle("Steampunk Rod (215k$)", "SteampunkRod", RodIDs.SteampunkRod)
createRodToggle("Chrome Rod (437k$)", "ChromeRod", RodIDs.ChromeRod)
createRodToggle("Astral Rod (1M$)", "AstralRod", RodIDs.AstralRod)

local MainSection = SpTab:CreateSection("shop bobber")

local Net = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net
local PurchaseBait = Net:FindFirstChild("RF/PurchaseBait")

-- ID c·ªßa c√°c lo·∫°i m·ªìi
local BaitIDs = {
    TopwaterBait = 10,    -- 100$
    LuckBait = 2,         -- 1k$
    MidnightBait = 3,     -- 3k$
    ChromaBait = 6,       -- 290k$
    DarkMatterBait = 8,   -- 630k$
    CorruptBait = 15,     -- 1.15M$
    RatherBait = 15,      -- 3.70M$  (chung ID v·ªõi CorruptBait, game c√≥ th·ªÉ d√πng ƒëi·ªÅu ki·ªán kh√°c)
}

-- L∆∞u tr·∫°ng th√°i toggle
local autoBuy = {}

-- H√†m auto mua
local function startAutoBuy(id, key)
    task.spawn(function()
        while autoBuy[key] do
            PurchaseBait:InvokeServer(id)
            task.wait(1) -- tr√°nh spam
        end
    end)
end

-- H√†m t·∫°o toggle nhanh
local function createBaitToggle(name, key, id)
    SpTab:CreateToggle({
        Name = "Auto Buy " .. name,
        CurrentValue = false,
        Flag = "Toggle_" .. key,
        SectionParent = MainSection,
        Callback = function(val)
            autoBuy[key] = val
            if val then startAutoBuy(id, key) end
        end,
    })
end

-- T·∫°o toggle cho t·ª´ng lo·∫°i m·ªìi
createBaitToggle("Topwater Bait (100$)", "Topwater", BaitIDs.TopwaterBait)
createBaitToggle("Luck Bait (1k$)", "Luck", BaitIDs.LuckBait)
createBaitToggle("Midnight Bait (3k$)", "Midnight", BaitIDs.MidnightBait)
createBaitToggle("Chroma Bait (290k$)", "Chroma", BaitIDs.ChromaBait)
createBaitToggle("Dark Matter Bait (630k$)", "DarkMatter", BaitIDs.DarkMatterBait)
createBaitToggle("Corrupt Bait (1.15M$)", "Corrupt", BaitIDs.CorruptBait)
createBaitToggle("Rather Bait (3.70M$)", "Rather", BaitIDs.RatherBait)

local IsdTab = Window:CreateTab("Tp islandüó∫Ô∏è", nil) -- Title, Image
    local MainSection = IsdTab:CreateSection("island")
    
    
    local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- H√†m l·∫•y HRP hi·ªán t·∫°i
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

-- Bi·∫øn l∆∞u HRP
local hrp = getHRP()

-- Khi nh√¢n v·∫≠t respawn -> c·∫≠p nh·∫≠t l·∫°i HRP
player.CharacterAdded:Connect(function(char)
    hrp = char:WaitForChild("HumanoidRootPart")
end)

-- H√†m TP
local function teleportToCFrame(cf)
    if hrp then
        hrp.CFrame = cf + Vector3.new(0, 5, 0) -- ƒë·ª©ng cao h∆°n 5 ƒë·ªÉ tr√°nh k·∫πt
    end
end

-- N√∫t Teleport Enchant Story
local EnchantBtn = IsdTab:CreateButton({
   Name = "Teleport Enchant Story",
   Callback = function()
      teleportToCFrame(CFrame.new(3229.3, -1280.5, 1403.3))
   end,
})
    
    
    local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- H√†m l·∫•y HRP hi·ªán t·∫°i
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

-- Bi·∫øn l∆∞u HRP
local hrp = getHRP()

-- Khi nh√¢n v·∫≠t respawn -> c·∫≠p nh·∫≠t l·∫°i HRP
player.CharacterAdded:Connect(function(char)
    hrp = char:WaitForChild("HumanoidRootPart")
end)

local islands = workspace["!!!! ISLAND LOCATIONS !!!!"]

local function teleportTo(part)
    if not hrp then return end
    if part and part:IsA("BasePart") then
        hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
    elseif part and part:FindFirstChild("Part") then
        hrp.CFrame = part.Part.CFrame + Vector3.new(0, 5, 0)
    end
end

-- Coral Reefs
local Button1 = IsdTab:CreateButton({
   Name = "Teleport Coral Reefs",
   Callback = function()
      teleportTo(islands["Coral Reefs"])
   end,
})

-- Crater Island
local Button2 = IsdTab:CreateButton({
   Name = "Teleport Crater Island",
   Callback = function()
      teleportTo(islands["Crater Island"])
   end,
})

-- Esoteric Depths
local Button3 = IsdTab:CreateButton({
   Name = "Teleport Esoteric Depths",
   Callback = function()
      teleportTo(islands["Esoteric Depths"])
   end,
})

-- Fisherman Island
local Button4 = IsdTab:CreateButton({
   Name = "Teleport Fisherman Island",
   Callback = function()
      teleportTo(islands["Fisherman Island"])
   end,
})

-- Kohana
local Button5 = IsdTab:CreateButton({
   Name = "Teleport Kohana",
   Callback = function()
      teleportTo(islands.Kohana)
   end,
})

-- Kohana Volcano
local Button6 = IsdTab:CreateButton({
   Name = "Teleport Kohana Volcano",
   Callback = function()
      teleportTo(islands["Kohana Volcano"])
   end,
})

-- Lost Isle
local Button7 = IsdTab:CreateButton({
   Name = "Teleport Lost Isle",
   Callback = function()
      teleportTo(islands["Lost Isle"])
   end,
})

-- Tropical Grove
local Button8 = IsdTab:CreateButton({
   Name = "Teleport Tropical Grove",
   Callback = function()
      teleportTo(islands["Tropical Grove"])
   end,
})

-- Weather Machine
local Button9 = IsdTab:CreateButton({
   Name = "Teleport Weather Machine",
   Callback = function()
      teleportTo(islands["Weather Machine"])
   end,
})

local StigTab = Window:CreateTab("settings ‚öì", nil) -- Title, Image
    local MainSection = StigTab:CreateSection("settings")

local AntiLagLevel = "Normal"

local Dropdown = StigTab:CreateDropdown({
   Name = " Anti-Lag Mode",
   Options = {"Normal", "Low", "Super Low", "Wireframe"},
   CurrentOption = {"Normal"},
   Flag = "AntiLagDropdown",
   Callback = function(Option)
      AntiLagLevel = Option[1]

      -- Restore mc nh
      if AntiLagLevel == "Normal" then
         settings().Rendering.QualityLevel = Enum.QualityLevel.Automatic
         game.Lighting.GlobalShadows = true
         game.Lighting.FogEnd = 1000
         game.Lighting.Brightness = 2
         game.Lighting.OutdoorAmbient = Color3.new(0.5, 0.5, 0.5)
         print(" Anti-Lag: Normal")
         return
      end

      -- Ch  Low, Super Low, Wireframe
      settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
      game.Lighting.GlobalShadows = false
      game.Lighting.FogEnd = 9999
      game.Lighting.Brightness = 1
      game.Lighting.OutdoorAmbient = Color3.new(1, 1, 1)

      local function optimize(v)
          -- Xo√° hiu ng nng
          if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") 
          or v:IsA("Fire") or v:IsA("Sparkles") or v:IsA("Beam") then
              v.Enabled = false
          end

          -- X l√Ω Part / MeshPart  th√†nh x√°m ti
          if v:IsA("MeshPart") or v:IsA("Part") then
              v.Material = Enum.Material.SmoothPlastic
              v.CastShadow = false

              if AntiLagLevel == "Wireframe" then
                  v.Color = Color3.fromRGB(60, 60, 60) -- x√°m ti
                  v.Transparency = 0.3
              else
                  v.Color = Color3.fromRGB(60, 60, 60) -- x√°m ti
                  v.Transparency = 0
              end

              if v:IsA("MeshPart") then
                  v.TextureID = "" -- xo√° texture
              end
          end

          -- Gim m√†u nh√¢n vt  x√°m ti
          if v:IsA("Shirt") or v:IsA("Pants") then
              v:Destroy()
          end
          if v:IsA("BodyColors") then
              v.HeadColor = BrickColor.new("Dark stone grey")
              v.LeftArmColor = BrickColor.new("Dark stone grey")
              v.RightArmColor = BrickColor.new("Dark stone grey")
              v.LeftLegColor = BrickColor.new("Dark stone grey")
              v.RightLegColor = BrickColor.new("Dark stone grey")
              v.TorsoColor = BrickColor.new("Dark stone grey")
          end

          -- Super Low xo√° th√™m ph kin/mt
          if AntiLagLevel == "Super Low" or AntiLagLevel == "Wireframe" then
              if v:IsA("Accessory") or v:IsA("Hat") then
                  v:Destroy()
              end
              if v:IsA("Decal") then
                  v:Destroy()
              end
          end
      end

      -- Qu√©t map + nh√¢n vt
      for _, v in pairs(workspace:GetDescendants()) do
          optimize(v)
      end
      workspace.DescendantAdded:Connect(optimize)
      for _, p in pairs(game.Players:GetPlayers()) do
          if p.Character then
              for _, part in pairs(p.Character:GetDescendants()) do
                  optimize(part)
              end
          end
      end

      print(" Anti-Lag: "..AntiLagLevel.." mode (Dark Gray)")
   end,
})

local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

local function serverHop()
    local gameId = game.PlaceId
    local currentJobId = game.JobId
    local servers = {}

    local success, result = pcall(function()
        return game:HttpGet("https://games.roblox.com/v1/games/"..gameId.."/servers/Public?sortOrder=Asc&limit=100")
    end)

    if not success then
        warn(" Kh√¥ng ly c danh s√°ch server")
        return
    end

    local data = HttpService:JSONDecode(result)
    for _, server in pairs(data.data) do
        if server.id ~= currentJobId and server.playing < server.maxPlayers then
            table.insert(servers, server.id)
        end
    end

    if #servers > 0 then
        local randomServer = servers[math.random(1, #servers)]
        TeleportService:TeleportToPlaceInstance(gameId, randomServer, Players.LocalPlayer)
        print(" ang chuyn sang server mi...")
    else
        warn(" Kh√¥ng t√¨m thy server ph√π hp")
    end
end

-- Button trong Rayfield
local Button = StigTab:CreateButton({
   Name = " Server Hop",
   Callback = function()
       serverHop()
   end,
})
